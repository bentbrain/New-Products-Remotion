"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.prepareServer = void 0;
const is_serve_url_1 = require("./is-serve-url");
const serve_static_1 = require("./serve-static");
const prepareServer = async ({ downloadDir, ffmpegExecutable, ffprobeExecutable, onDownload, onError, webpackConfigOrServeUrl, port, }) => {
    if ((0, is_serve_url_1.isServeUrl)(webpackConfigOrServeUrl)) {
        const { port: offthreadPort, close: closeProxy } = await (0, serve_static_1.serveStatic)(null, {
            downloadDir,
            onDownload,
            onError,
            ffmpegExecutable,
            ffprobeExecutable,
            port,
        });
        return Promise.resolve({
            serveUrl: webpackConfigOrServeUrl,
            closeServer: () => closeProxy(),
            offthreadPort,
        });
    }
    const { port: serverPort, close } = await (0, serve_static_1.serveStatic)(webpackConfigOrServeUrl, {
        downloadDir,
        onDownload,
        onError,
        ffmpegExecutable,
        ffprobeExecutable,
        port,
    });
    return Promise.resolve({
        closeServer: () => {
            return close();
        },
        serveUrl: `http://localhost:${serverPort}`,
        offthreadPort: serverPort,
    });
};
exports.prepareServer = prepareServer;
