"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useKeybinding = void 0;
const react_1 = require("react");
const keybindings_1 = require("../state/keybindings");
const z_index_1 = require("../state/z-index");
const useKeybinding = () => {
    const [paneId] = (0, react_1.useState)(() => String(Math.random()));
    const context = (0, react_1.useContext)(keybindings_1.KeybindingContext);
    const { isHighestContext } = (0, z_index_1.useZIndex)();
    const registerKeybinding = (0, react_1.useCallback)((event, key, callback) => {
        if (!isHighestContext) {
            return {
                unregister: () => undefined,
            };
        }
        const listener = (e) => {
            if (e.key.toLowerCase() === key.toLowerCase()) {
                callback(e);
            }
        };
        const toRegister = {
            registeredFromPane: paneId,
            event,
            key,
            callback: listener,
            id: String(Math.random()),
        };
        context.registerKeybinding(toRegister);
        return {
            unregister: () => context.unregisterKeybinding(toRegister),
        };
    }, [context, isHighestContext, paneId]);
    (0, react_1.useEffect)(() => {
        return () => {
            context.unregisterPane(paneId);
        };
    }, [context, paneId]);
    return (0, react_1.useMemo)(() => ({ registerKeybinding, isHighestContext }), [registerKeybinding, isHighestContext]);
};
exports.useKeybinding = useKeybinding;
